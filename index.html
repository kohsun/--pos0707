
<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>èŠ±åº— POS æ”¶éŠ€æ©Ÿ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #ff6b9d;
      --primary-dark: #e85a8a;
      --secondary: #ffd93d;
      --bg: #fff5f8;
      --card-bg: #fff;
      --text: #2d3436;
      --text-light: #636e72;
      --border: #ffe0eb;
      --success: #6bcf7f;
      --danger: #ff6b6b;
      --shadow: 0 4px 20px rgba(255, 107, 157, 0.15);
    }

    body {
      font-family: 'Noto Sans TC', sans-serif;
      background: linear-gradient(135deg, #fff5f8 0%, #ffe8f0 100%);
      color: var(--text);
      min-height: 100vh;
    }

    .pos-app {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      background: linear-gradient(135deg, var(--primary) 0%, #ff8cb4 100%);
      color: white;
      padding: 25px 30px;
      border-radius: 20px;
      margin-bottom: 25px;
      box-shadow: 0 8px 40px rgba(255, 107, 157, 0.25);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    header h1 {
      font-size: 2rem;
      font-weight: 700;
    }

    .user-badge {
      background: rgba(255, 255, 255, 0.25);
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .user-badge:hover {
      background: rgba(255, 255, 255, 0.35);
    }

    .admin-badge {
      background: gold;
      color: var(--text);
      padding: 3px 8px;
      border-radius: 10px;
      font-size: 0.75rem;
      font-weight: 700;
    }

    #summary {
      background: rgba(255, 255, 255, 0.2);
      padding: 12px 20px;
      border-radius: 12px;
      font-weight: 500;
    }

    .order-controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .order-controls button {
      padding: 12px 18px;
      border: none;
      border-radius: 12px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      white-space: nowrap;
      background: rgba(255, 255, 255, 0.25);
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.5);
    }

    .order-controls button:hover {
      background: rgba(255, 255, 255, 0.35);
      transform: translateY(-2px);
    }

    #hold-btn {
      background: var(--secondary);
      color: var(--text);
    }

    .main {
      display: grid;
      grid-template-columns: 1fr 420px;
      gap: 25px;
      height: calc(100vh - 140px);
    }

    .left,
    .right {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 25px;
      box-shadow: var(--shadow);
    }

    #search {
      width: 100%;
      padding: 15px 20px;
      border: 2px solid var(--border);
      border-radius: 12px;
      font-size: 1rem;
      margin-bottom: 20px;
    }

    #search:focus {
      outline: none;
      border-color: var(--primary);
    }

    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      overflow-x: auto;
    }

    .tab {
      padding: 12px 24px;
      border: 2px solid var(--border);
      background: white;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .tab:hover {
      border-color: var(--primary);
      background: #fff0f5;
    }

    .tab.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    #products {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 15px;
      overflow-y: auto;
      height: calc(100vh - 380px);
      align-content: start;
    }

    .product {
      background: linear-gradient(135deg, #fff 0%, #fff5f8 100%);
      border: 2px solid var(--border);
      border-radius: 15px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      position: relative;
    }

    .product:hover {
      transform: translateY(-5px);
      border-color: var(--primary);
      box-shadow: var(--shadow);
    }

    .product-emoji {
      font-size: 2.5rem;
      margin-bottom: 8px;
    }

    .product-name {
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 0.95rem;
    }

    .product-price {
      color: var(--primary);
      font-weight: 700;
      font-size: 1.1rem;
    }

    .product-edit-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      font-size: 0.9rem;
      cursor: pointer;
      display: none;
    }

    .product:hover .product-edit-btn {
      display: block;
    }

    .right {
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      max-height: calc(100vh - 140px);
    }

    #order-list {
      max-height: 200px;
      overflow-y: auto;
      margin-bottom: 20px;
      min-height: 100px;
      position: relative;
    }

    .order-item {
      background: var(--bg);
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .order-item-emoji {
      font-size: 1.8rem;
    }

    .order-item-info {
      flex: 1;
    }

    .order-item-name {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .qty-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .qty-btn {
      width: 32px;
      height: 32px;
      border: none;
      border-radius: 8px;
      background: var(--primary);
      color: white;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
    }

    .item-remove {
      background: var(--danger);
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    .total {
      background: linear-gradient(135deg, var(--primary) 0%, #ff8cb4 100%);
      color: white;
      padding: 12px 15px;
      border-radius: 10px;
      font-size: 1.2rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 10px;
    }

    .discount-section {
      background: var(--bg);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 10px;
      border: 2px solid var(--border);
    }

    .discount-input-group {
      display: flex;
      gap: 8px;
    }

    .discount-input {
      flex: 1;
      padding: 10px 15px;
      border: 2px solid var(--border);
      border-radius: 8px;
      text-align: center;
      font-weight: 600;
    }

    .discount-apply-btn {
      padding: 10px 20px;
      border: none;
      background: var(--primary);
      color: white;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }

    .payment-display {
      background: var(--bg);
      padding: 12px 15px;
      border-radius: 10px;
      text-align: center;
      margin-bottom: 10px;
      font-size: 1.1rem;
      font-weight: 600;
      border: 2px solid var(--border);
    }

    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 10px;
    }

    .controls button {
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
    }

    #pay {
      background: linear-gradient(135deg, var(--success) 0%, #5cb85c 100%);
      color: white;
    }

    #pay:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    #clear {
      background: linear-gradient(135deg, var(--danger) 0%, #e74c3c 100%);
      color: white;
    }

    #change {
      background: var(--secondary);
      color: var(--text);
      padding: 12px 15px;
      border-radius: 10px;
      text-align: center;
      font-size: 1.1rem;
      font-weight: 700;
    }

    .keyboard {
      background: var(--bg);
      border-radius: 12px;
      padding: 15px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-top: 15px;
    }

    .key {
      padding: 15px;
      border: 2px solid var(--border);
      background: white;
      border-radius: 10px;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
    }

    .key:hover {
      background: var(--primary);
      color: white;
    }

    .key.clear,
    .key.back {
      background: linear-gradient(135deg, var(--danger) 0%, #e74c3c 100%);
      color: white;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-light);
    }

    .empty-state-emoji {
      font-size: 4rem;
      margin-bottom: 15px;
    }

    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      z-index: 1000;
    }

    .modal-overlay.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal {
      background: white;
      border-radius: 20px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .modal.large {
      max-width: 800px;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--border);
    }

    .modal-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.8rem;
      cursor: pointer;
      color: var(--text-light);
    }

    .price-presets {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }

    .price-preset-btn {
      padding: 10px;
      background: var(--secondary);
      border: none;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      font-size: 1.1rem;
      transition: 0.2s;
    }

    .price-preset-btn:hover {
      background: #f1c40f;
      transform: scale(1.05);
    }

    .staff-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }

    .staff-card {
      background: linear-gradient(135deg, var(--primary) 0%, #ff8cb4 100%);
      color: white;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
    }

    .staff-card:hover {
      transform: translateY(-5px);
    }

    .staff-emoji {
      font-size: 3rem;
      margin-bottom: 10px;
    }

    .staff-name {
      font-size: 1.3rem;
      font-weight: 700;
    }

    .staff-admin-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: gold;
      color: var(--text);
      padding: 4px 10px;
      border-radius: 10px;
      font-size: 0.8rem;
      font-weight: 700;
    }

    .add-staff-btn {
      background: white;
      color: var(--primary);
      border: 3px dashed var(--primary);
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      cursor: pointer;
      font-size: 2rem;
      font-weight: 700;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .form-input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid var(--border);
      border-radius: 10px;
      font-size: 1rem;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .btn-primary {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, var(--primary) 0%, #ff8cb4 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
    }

    .modal-keyboard {
      background: var(--bg);
      border-radius: 12px;
      padding: 12px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-top: 15px;
    }

    .modal-key {
      padding: 15px;
      border: 2px solid var(--border);
      background: white;
      border-radius: 10px;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
      text-align: center;
    }

    .modal-key:hover {
      background: var(--primary);
      color: white;
    }

    .modal-key.wide {
      grid-column: span 2;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 15px;
      background: var(--bg);
      border-radius: 10px;
    }

    .calendar-nav-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    .calendar-month {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--primary);
    }

    .calendar-view {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .calendar-day {
      background: var(--bg);
      padding: 15px 10px;
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      border: 2px solid var(--border);
    }

    .calendar-day.has-data {
      background: linear-gradient(135deg, var(--primary) 0%, #ff8cb4 100%);
      color: white;
      font-weight: 700;
    }

    .calendar-date {
      font-weight: 700;
      font-size: 1.2rem;
      margin-bottom: 5px;
    }

    .calendar-revenue {
      font-size: 0.85rem;
      opacity: 0.9;
    }

    .day-detail-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .history-order-card {
      background: var(--bg);
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 15px;
      border: 2px solid var(--border);
      cursor: pointer;
      transition: all 0.3s;
    }

    .history-order-card:hover {
      border-color: var(--primary);
      transform: translateX(5px);
    }

    .history-order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .history-order-time {
      font-weight: 600;
      color: var(--text);
    }

    .history-order-total {
      font-weight: 700;
      color: var(--primary);
      font-size: 1.2rem;
    }

    .history-order-items {
      color: var(--text-light);
      font-size: 0.9rem;
      margin-bottom: 8px;
    }

    .history-order-detail {
      font-size: 0.85rem;
      color: var(--text-light);
      padding-top: 8px;
      border-top: 1px dashed var(--border);
    }

    .order-detail-section {
      background: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 15px;
    }

    .order-detail-header {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--border);
    }

    .order-detail-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid var(--bg);
    }

    .order-detail-item:last-child {
      border-bottom: none;
    }

    .order-detail-name {
      font-weight: 600;
    }

    .order-detail-price {
      color: var(--text-light);
    }

    .order-detail-subtotal {
      font-weight: 700;
      color: var(--primary);
    }

    .order-summary-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      font-size: 1.1rem;
    }

    .order-summary-row.total {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--primary);
      padding-top: 15px;
      border-top: 2px solid var(--border);
      margin-top: 10px;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <div class="pos-app">
    <header>
      <div class="header-left">
        <h1>ğŸŒ¸ èŠ±å°åº— æ”¶éŠ€æ©Ÿ</h1>
        <div class="user-badge" onclick="openModal('staff-modal')">
          <span id="current-user">ğŸ‘¤ é¸æ“‡äººå“¡</span>
          <span id="admin-indicator"></span>
        </div>
        <div id="summary" style="display:none"><span id="revenue-container">ç‡Ÿæ”¶ $<span id="daily-revenue">0</span> |
          </span>æš«å­˜ <span id="holds-count">0</span></div>
      </div>
      <div class="order-controls">
        <button onclick="openHistory()">ğŸ“… æ­·å²</button>
        <button onclick="newOrder()">ğŸ†• æ–°è¨‚å–®</button>
        <button id="hold-btn" onclick="holdOrder()">â¸ï¸ æš«å­˜ <span id="hold-btn-count"
            style="display:none;background:#ff6b6b;color:white;padding:2px 6px;border-radius:10px;font-size:0.8em;vertical-align:middle;margin-left:4px;">0</span></button>
        <button onclick="showHeldOrders()">ğŸ“‹ æš«å­˜æ¸…å–®</button>
        <button onclick="endDay()">ğŸŒ™ çµæŸç‡Ÿæ¥­</button>
      </div>
    </header>

    <div class="main">
      <div class="left">
        <input id="search" placeholder="æœå°‹å•†å“... ğŸ”" oninput="searchProducts(this.value)">
        <div class="tabs">
          <button class="tab active" onclick="filterCategory('all')">å…¨éƒ¨</button>
          <button class="tab" onclick="filterCategory('bouquet')">èŠ±æŸ</button>
          <button class="tab" onclick="filterCategory('accessory')">é…ä»¶</button>
          <button class="tab" onclick="filterCategory('decoration')">è£é£¾å“</button>
          <button class="tab" onclick="filterCategory('custom')">è‡ªè¨‚</button>
        </div>
        <div id="products"></div>
      </div>

      <div class="right">
        <div style="position:relative">
          <div id="order-list">
            <div class="empty-state">
              <div class="empty-state-emoji">ğŸŒº</div>
              <div class="empty-state-text">é»æ“Šå•†å“åŠ å…¥è¨‚å–®</div>
            </div>
          </div>
          <div
            style="position:absolute;top:10px;right:10px;background:rgba(255,107,157,0.9);color:white;padding:8px 15px;border-radius:20px;font-weight:700;font-size:0.95rem;box-shadow:0 2px 8px rgba(0,0,0,0.15)"
            id="total-items-badge">
            å…± <span id="total-items">0</span> ä»¶
          </div>
        </div>
        <div class="total">æ‡‰æ”¶:<span id="total">$0</span></div>
        <div class="discount-section">
          <div style="font-size:0.9rem;color:var(--text-light);margin-bottom:8px;text-align:center">ğŸ’° æŠ˜æ‰£é‡‘é¡</div>
          <div class="discount-input-group">
            <input type="number" class="discount-input" id="discount-amount" placeholder="æŠ˜æ‰£é‡‘é¡" value="0"
              onclick="showDiscountKeyboard()" readonly>
            <button class="discount-apply-btn" onclick="applyDiscount()">å¥—ç”¨</button>
          </div>
          <div class="modal-keyboard" id="discount-keyboard" style="display:none;margin-top:10px">
            <button class="modal-key" onclick="discountKeyInput('7')">7</button>
            <button class="modal-key" onclick="discountKeyInput('8')">8</button>
            <button class="modal-key" onclick="discountKeyInput('9')">9</button>
            <button class="modal-key" onclick="discountKeyInput('4')">4</button>
            <button class="modal-key" onclick="discountKeyInput('5')">5</button>
            <button class="modal-key" onclick="discountKeyInput('6')">6</button>
            <button class="modal-key" onclick="discountKeyInput('1')">1</button>
            <button class="modal-key" onclick="discountKeyInput('2')">2</button>
            <button class="modal-key" onclick="discountKeyInput('3')">3</button>
            <button class="modal-key" onclick="discountKeyInput('0')">0</button>
            <button class="modal-key" onclick="discountKeyInput('00')">00</button>
            <button class="modal-key" onclick="discountKeyInput('â†')">â†</button>
            <button class="modal-key wide" onclick="discountKeyInput('C')">æ¸…é™¤</button>
            <button class="modal-key" onclick="hideDiscountKeyboard()">æ”¶èµ·</button>
          </div>
        </div>
        <div class="payment-display">å¯¦æ”¶:<span id="payment-display">$0</span></div>
        <div class="controls">
          <button id="pay" onclick="checkout()" disabled>âœ… çµå¸³</button>
          <button id="clear" onclick="newOrder()">âŒ æ¸…ç©º</button>
        </div>
        <div id="change">æ‰¾é›¶ $0</div>

        <div class="keyboard">
          <button class="key" onclick="handleKey('7')">7</button>
          <button class="key" onclick="handleKey('8')">8</button>
          <button class="key" onclick="handleKey('9')">9</button>
          <button class="key clear" onclick="handleKey('C')">C</button>
          <button class="key" onclick="handleKey('4')">4</button>
          <button class="key" onclick="handleKey('5')">5</button>
          <button class="key" onclick="handleKey('6')">6</button>
          <button class="key back" onclick="handleKey('â†')">â†</button>
          <button class="key" onclick="handleKey('1')">1</button>
          <button class="key" onclick="handleKey('2')">2</button>
          <button class="key" onclick="handleKey('3')">3</button>
          <button class="key" onclick="handleKey('.')">.</button>
          <button class="key" onclick="handleKey('0')">0</button>
          <button class="key" onclick="handleKey('00')">00</button>
          <button class="key" onclick="handleKey('000')">000</button>
          <button class="key" style="opacity:0;pointer-events:none"></button>
        </div>
      </div>
    </div>
  </div>

  <!-- Staff Modal -->
  <div class="modal-overlay" id="staff-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">ğŸ‘¥ äººå“¡ç™»å…¥</div>
        <button class="modal-close" onclick="closeModal('staff-modal')">Ã—</button>
      </div>
      <div class="staff-grid" id="staff-list"></div>
    </div>
  </div>

  <!-- Add Staff Modal -->
  <div class="modal-overlay" id="add-staff-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">â• æ–°å¢äººå“¡</div>
        <button class="modal-close" onclick="closeModal('add-staff-modal')">Ã—</button>
      </div>
      <div class="form-group">
        <label class="form-label">äººå“¡åç¨±</label>
        <input type="text" class="form-input" id="new-staff-name" placeholder="ä¾‹å¦‚: å°æ˜">
      </div>
      <div class="form-group">
        <label class="form-label">åœ–ç¤º (emoji)</label>
        <input type="text" class="form-input" id="new-staff-emoji" placeholder="ä¾‹å¦‚: ğŸ‘¨" maxlength="2">
      </div>
      <button class="btn-primary" onclick="addStaff()">æ–°å¢äººå“¡</button>
    </div>
  </div>

  <!-- Admin Password Modal -->
  <div class="modal-overlay" id="admin-password-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">ğŸ” ç®¡ç†å“¡å¯†ç¢¼</div>
        <button class="modal-close" onclick="closeModal('admin-password-modal')">Ã—</button>
      </div>
      <div class="form-group">
        <label class="form-label">è«‹è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼</label>
        <input type="password" class="form-input" id="admin-password-input" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" maxlength="4">
      </div>
      <div class="modal-keyboard">
        <button class="modal-key" onclick="adminPasswordKeyInput('7')">7</button>
        <button class="modal-key" onclick="adminPasswordKeyInput('8')">8</button>
        <button class="modal-key" onclick="adminPasswordKeyInput('9')">9</button>
        <button class="modal-key" onclick="adminPasswordKeyInput('4')">4</button>
        <button class="modal-key" onclick="adminPasswordKeyInput('5')">5</button>
        <button class="modal-key" onclick="adminPasswordKeyInput('6')">6</button>
        <button class="modal-key" onclick="adminPasswordKeyInput('1')">1</button>
        <button class="modal-key" onclick="adminPasswordKeyInput('2')">2</button>
        <button class="modal-key" onclick="adminPasswordKeyInput('3')">3</button>
        <button class="modal-key" onclick="adminPasswordKeyInput('0')">0</button>
        <button class="modal-key" onclick="adminPasswordKeyInput('00')">00</button>
        <button class="modal-key" onclick="adminPasswordKeyInput('â†')">â†</button>
        <button class="modal-key wide" onclick="adminPasswordKeyInput('C')">æ¸…é™¤</button>
        <button class="modal-key" onclick="verifyAdminPassword()">ç¢ºèª</button>
      </div>
    </div>
  </div>

  <!-- Edit Product Modal -->
  <div class="modal-overlay" id="edit-product-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">âœï¸ ç·¨è¼¯å•†å“åƒ¹æ ¼</div>
        <button class="modal-close" onclick="closeModal('edit-product-modal')">Ã—</button>
      </div>
      <div class="form-group">
        <label class="form-label">å•†å“åç¨±</label>
        <input type="text" class="form-input" id="edit-product-name" readonly>
      </div>
      <div class="form-group">
        <label class="form-label">æ–°åƒ¹æ ¼</label>
        <input type="number" class="form-input" id="edit-product-price" placeholder="è¼¸å…¥æ–°åƒ¹æ ¼">
      </div>
      <div class="modal-keyboard">
        <button class="modal-key" onclick="editPriceKeyInput('7')">7</button>
        <button class="modal-key" onclick="editPriceKeyInput('8')">8</button>
        <button class="modal-key" onclick="editPriceKeyInput('9')">9</button>
        <button class="modal-key" onclick="editPriceKeyInput('4')">4</button>
        <button class="modal-key" onclick="editPriceKeyInput('5')">5</button>
        <button class="modal-key" onclick="editPriceKeyInput('6')">6</button>
        <button class="modal-key" onclick="editPriceKeyInput('1')">1</button>
        <button class="modal-key" onclick="editPriceKeyInput('2')">2</button>
        <button class="modal-key" onclick="editPriceKeyInput('3')">3</button>
        <button class="modal-key" onclick="editPriceKeyInput('0')">0</button>
        <button class="modal-key" onclick="editPriceKeyInput('00')">00</button>
        <button class="modal-key" onclick="editPriceKeyInput('â†')">â†</button>
        <button class="modal-key wide" onclick="editPriceKeyInput('C')">æ¸…é™¤</button>
        <button class="modal-key" onclick="saveProductPrice()">å„²å­˜</button>
      </div>
    </div>
  </div>

  <!-- Custom Product Modal -->
  <div class="modal-overlay" id="custom-product-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title" id="custom-modal-title">ğŸŒ¿ ç›†æ ½</div>
        <button class="modal-close" onclick="closeModal('custom-product-modal')">Ã—</button>
      </div>

      <div id="price-preset-container" style="display:none; margin-bottom: 15px;">
        <label class="form-label">å¿«é€Ÿé¸åƒ¹</label>
        <div class="price-presets">
          <button class="price-preset-btn" onclick="setPresetPrice(500)">$500</button>
          <button class="price-preset-btn" onclick="setPresetPrice(600)">$600</button>
          <button class="price-preset-btn" onclick="setPresetPrice(700)">$700</button>
          <button class="price-preset-btn" onclick="setPresetPrice(800)">$800</button>
        </div>
      </div>

      <div class="form-group" id="custom-name-group">
        <label class="form-label" id="custom-name-label">å•†å“åç¨±</label>
        <input type="text" class="form-input" id="custom-product-name" placeholder="ä¾‹å¦‚: å¤šè‚‰æ¤ç‰©">
      </div>
      <div class="form-group">
        <label class="form-label">åƒ¹æ ¼ (æ‰‹å‹•è¼¸å…¥)</label>
        <input type="number" class="form-input" id="custom-product-price" placeholder="ä¾‹å¦‚: 299">
      </div>
      <div class="modal-keyboard">
        <button class="modal-key" onclick="modalKeyInput('7')">7</button>
        <button class="modal-key" onclick="modalKeyInput('8')">8</button>
        <button class="modal-key" onclick="modalKeyInput('9')">9</button>
        <button class="modal-key" onclick="modalKeyInput('4')">4</button>
        <button class="modal-key" onclick="modalKeyInput('5')">5</button>
        <button class="modal-key" onclick="modalKeyInput('6')">6</button>
        <button class="modal-key" onclick="modalKeyInput('1')">1</button>
        <button class="modal-key" onclick="modalKeyInput('2')">2</button>
        <button class="modal-key" onclick="modalKeyInput('3')">3</button>
        <button class="modal-key" onclick="modalKeyInput('0')">0</button>
        <button class="modal-key" onclick="modalKeyInput('00')">00</button>
        <button class="modal-key" onclick="modalKeyInput('â†')">â†</button>
        <button class="modal-key wide" onclick="modalKeyInput('C')">æ¸…é™¤</button>
        <button class="modal-key" onclick="modalKeyInput('000')">000</button>
      </div>
      <button class="btn-primary" onclick="addCustomProduct()" style="margin-top: 15px;">åŠ å…¥è¨‚å–®</button>
    </div>
  </div>

  <!-- History Modal -->
  <div class="modal-overlay" id="history-modal">
    <div class="modal large">
      <div class="modal-header">
        <div class="modal-title">ğŸ“… ç‡Ÿé‹æ­·å²</div>
        <button class="modal-close" onclick="closeModal('history-modal')">Ã—</button>
      </div>
      <div class="calendar-header">
        <button class="calendar-nav-btn" onclick="changeMonth(-1)">â—€ ä¸Šæœˆ</button>
        <div class="calendar-month" id="calendar-month"></div>
        <button class="calendar-nav-btn" onclick="changeMonth(1)">ä¸‹æœˆ â–¶</button>
      </div>
      <div class="calendar-view" id="calendar-view"></div>
    </div>
  </div>

  <!-- Day Detail Modal -->
  <div class="modal-overlay" id="day-detail-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title" id="day-detail-title">ğŸ“‹ è¨‚å–®æ˜ç´°</div>
        <button class="modal-close" onclick="closeModal('day-detail-modal')">Ã—</button>
      </div>
      <div class="day-detail-list" id="day-detail-list"></div>
    </div>
  </div>

  <!-- Order Detail Modal -->
  <div class="modal-overlay" id="order-detail-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">ğŸ“„ è¨‚å–®è©³æƒ…</div>
        <button class="modal-close" onclick="closeModal('order-detail-modal')">Ã—</button>
      </div>
      <div id="order-detail-content"></div>
    </div>
  </div>

  <!-- Quick Price Select Modal -->
  <div class="modal-overlay" id="quick-price-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title" id="quick-price-title">é¸æ“‡åƒ¹æ ¼</div>
        <button class="modal-close" onclick="closeModal('quick-price-modal')">Ã—</button>
      </div>
      <div style="font-size:0.95rem;color:var(--text-light);margin-bottom:15px;text-align:center">
        é»æ“Šåƒ¹æ ¼ç›´æ¥åŠ å…¥è³¼ç‰©è»Š
      </div>
      <div id="quick-price-buttons" class="price-presets"></div>
    </div>
  </div>

  <!-- Decoration Select Modal -->
  <div class="modal-overlay" id="decoration-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title" id="decoration-title">é¸æ“‡æ¬¾å¼</div>
        <button class="modal-close" onclick="closeModal('decoration-modal')">Ã—</button>
      </div>
      <div style="font-size:0.95rem;color:var(--text-light);margin-bottom:15px;text-align:center">
        æ‰€æœ‰æ¬¾å¼å‡ç‚º $20
      </div>
      <div id="decoration-buttons" class="price-presets"></div>
    </div>
  </div>

  <!-- Held Orders Modal -->
  <div class="modal-overlay" id="held-orders-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">ğŸ“‹ æš«å­˜è¨‚å–®æ¸…å–®</div>
        <button class="modal-close" onclick="closeModal('held-orders-modal')">Ã—</button>
      </div>
      <div id="held-orders-list" class="day-detail-list"></div>
    </div>
  </div>

  <script>
    // ===== åˆå§‹åŒ–æ•¸æ“š =====
    let products = [
      { id: 1, name: 'ç«ç‘°èŠ±æŸ', price: 0, emoji: 'ğŸŒ¹', category: 'bouquet', hasOptions: true, options: [400, 450, 500] },
      { id: 2, name: 'å‘æ—¥è‘µæŸ', price: 450, emoji: 'ğŸŒ»', category: 'bouquet' },
      { id: 3, name: 'é¬±é‡‘é¦™æŸ', price: 520, emoji: 'ğŸŒ·', category: 'bouquet' },
      { id: 4, name: 'ç™¾åˆèŠ±æŸ', price: 0, emoji: 'ğŸŒº', category: 'bouquet', hasOptions: true, options: [500, 600, 700, 800] },
      { id: 5, name: 'åº·ä¹ƒé¦¨æŸ', price: 380, emoji: 'ğŸŒ¸', category: 'bouquet' },
      { id: 6, name: 'æ»¿å¤©æ˜ŸæŸ', price: 420, emoji: 'ğŸ’', category: 'bouquet' },
      { id: 7, name: 'ç¹¡çƒèŠ±æŸ', price: 750, emoji: 'ğŸª»', category: 'bouquet' },
      { id: 8, name: 'æ··åˆèŠ±æŸ', price: 880, emoji: 'ğŸ’', category: 'bouquet' },
      { id: 9, name: 'åŒ…è£ç´™', price: 50, emoji: 'ğŸ“„', category: 'accessory' },
      { id: 10, name: 'ç·å¸¶', price: 30, emoji: 'ğŸ€', category: 'accessory' },
      { id: 11, name: 'èŠ±ç“¶', price: 250, emoji: 'ğŸº', category: 'accessory' },
      { id: 12, name: 'è³€å¡', price: 40, emoji: 'ğŸ’Œ', category: 'accessory' },
      { id: 13, name: 'èŠ±ç›’', price: 120, emoji: 'ğŸ', category: 'accessory' },
      { id: 14, name: 'ä¿é®®åŠ‘', price: 60, emoji: 'ğŸ’§', category: 'accessory' },
      { id: 15, name: 'ç›†æ ½', price: 0, emoji: 'ğŸŒ¿', category: 'custom', isCustom: true },
      {
        id: 16, name: 'è£é£¾å“', price: 0, emoji: 'âœ¨', category: 'decoration', hasSubItems: true, subItems: [
          { name: 'A', emoji: 'ğŸ…°ï¸' },
          { name: 'B', emoji: 'ğŸ…±ï¸' },
          { name: 'C', emoji: 'ğŸ†' },
          { name: 'D', emoji: 'ğŸ…¾ï¸' },
          { name: 'E', emoji: 'ğŸ”¤' },
          { name: 'F', emoji: 'ğŸ”¡' },
          { name: 'G', emoji: 'ğŸ” ' },
          { name: 'H', emoji: 'ğŸ’ ' }
        ]
      }
    ];

    let staffList = [
      { id: 1, name: 'äººå“¡ 1', emoji: 'ğŸ‘¨â€ğŸ’¼', isAdmin: true }
    ];

    let currentStaff = null;
    let currentOrder = [];
    let heldOrders = [];
    let orderHistory = {};
    let dailyRevenue = 0;
    let paymentInput = '';
    let discountAmount = 0;
    let currentCategory = 'all';
    let currentMonth = new Date();
    let editingProductId = null;

    const ADMIN_PASSWORD = '1234';

    // ===== åˆå§‹åŒ– =====
    function init() {
      loadData();
      renderStaffList();
      renderProducts();
      updateDisplay();
      updateCalendar();
    }

    // ===== æ•¸æ“šæŒä¹…åŒ– =====
    function saveData() {
      localStorage.setItem('posProducts', JSON.stringify(products));
      localStorage.setItem('posStaff', JSON.stringify(staffList));
      localStorage.setItem('posOrderHistory', JSON.stringify(orderHistory));
      localStorage.setItem('posDailyRevenue', dailyRevenue.toString());
    }

    function loadData() {
      const savedProducts = localStorage.getItem('posProducts');
      const savedStaff = localStorage.getItem('posStaff');
      const savedHistory = localStorage.getItem('posOrderHistory');
      const savedRevenue = localStorage.getItem('posDailyRevenue');

      if (savedProducts) products = JSON.parse(savedProducts);
      if (savedStaff) staffList = JSON.parse(savedStaff);
      if (savedHistory) orderHistory = JSON.parse(savedHistory);
      if (savedRevenue) dailyRevenue = parseFloat(savedRevenue);
    }

    // ===== äººå“¡ç®¡ç† =====
    function renderStaffList() {
      const list = document.getElementById('staff-list');
      list.innerHTML = staffList.map(s => `
        <div class="staff-card" onclick="selectStaff(${s.id})">
          ${s.isAdmin ? '<div class="staff-admin-badge">ç®¡ç†å“¡</div>' : ''}
          <div class="staff-emoji">${s.emoji}</div>
          <div class="staff-name">${s.name}</div>
        </div>
      `).join('') + `
        <div class="add-staff-btn" onclick="openAddStaffModal()">
          â•<br>æ–°å¢äººå“¡
        </div>
      `;
    }

    function openAddStaffModal() {
      closeModal('staff-modal');
      document.getElementById('new-staff-name').value = '';
      document.getElementById('new-staff-emoji').value = '';
      openModal('add-staff-modal');
    }

    function addStaff() {
      const name = document.getElementById('new-staff-name').value.trim();
      const emoji = document.getElementById('new-staff-emoji').value.trim();

      if (!name) {
        alert('âŒ è«‹è¼¸å…¥äººå“¡åç¨±ï¼');
        return;
      }

      const newId = Math.max(...staffList.map(s => s.id)) + 1;
      staffList.push({
        id: newId,
        name: name,
        emoji: emoji || 'ğŸ‘¤',
        isAdmin: false
      });

      saveData();
      renderStaffList();
      closeModal('add-staff-modal');
      openModal('staff-modal');
      alert(`âœ… å·²æ–°å¢äººå“¡: ${name}`);
    }

    function selectStaff(staffId) {
      const staff = staffList.find(s => s.id === staffId);
      if (!staff) return;

      if (staff.isAdmin) {
        // ç®¡ç†å“¡éœ€è¦å¯†ç¢¼é©—è­‰
        document.getElementById('admin-password-input').value = '';
        closeModal('staff-modal');
        openModal('admin-password-modal');
        window.pendingAdminStaff = staff;
      } else {
        currentStaff = staff;
        updateStaffDisplay();
        closeModal('staff-modal');
      }
    }

    function adminPasswordKeyInput(val) {
      const input = document.getElementById('admin-password-input');
      if (val === 'C') {
        input.value = '';
      } else if (val === 'â†') {
        input.value = input.value.slice(0, -1);
      } else {
        if (input.value.length < 4) {
          input.value += val;
        }
      }
    }

    function verifyAdminPassword() {
      const input = document.getElementById('admin-password-input').value;
      if (input === ADMIN_PASSWORD) {
        currentStaff = window.pendingAdminStaff;
        updateStaffDisplay();
        closeModal('admin-password-modal');
        alert('âœ… ç®¡ç†å“¡ç™»å…¥æˆåŠŸï¼');
      } else {
        alert('âŒ å¯†ç¢¼éŒ¯èª¤ï¼');
        document.getElementById('admin-password-input').value = '';
      }
    }

    function updateStaffDisplay() {
      if (currentStaff) {
        document.getElementById('current-user').textContent = `${currentStaff.emoji} ${currentStaff.name}`;
        const summaryEl = document.getElementById('summary');

        // ç‚ºæ‰€æœ‰äººé¡¯ç¤ºæš«å­˜æ•¸é‡ï¼Œä½†ç‡Ÿæ”¶åƒ…é™ç®¡ç†å“¡
        document.getElementById('summary').style.display = 'block';

        const revenueContainer = document.getElementById('revenue-container');
        if (currentStaff.isAdmin) {
          document.getElementById('admin-indicator').innerHTML = '<span class="admin-badge">ç®¡ç†å“¡</span>';
          revenueContainer.style.display = 'inline';
        } else {
          document.getElementById('admin-indicator').innerHTML = '';
          revenueContainer.style.display = 'none';
        }
      } else {
        // æœªç™»å…¥æ™‚éš±è—
        document.getElementById('summary').style.display = 'none';
      }
      renderProducts(); // é‡æ–°æ¸²æŸ“å•†å“ä»¥é¡¯ç¤ºç·¨è¼¯æŒ‰éˆ•
    }

    // ===== å•†å“ç®¡ç† =====
    function renderProducts() {
      const container = document.getElementById('products');
      const filtered = products.filter(p => {
        if (currentCategory !== 'all' && p.category !== currentCategory) return false;
        return true;
      });

      container.innerHTML = filtered.map(p => {
        let priceDisplay = p.hasOptions ? `$${p.options[0]}-${p.options[p.options.length - 1]}` :
          p.hasSubItems ? 'å¤šæ¬¾é¸æ“‡' :
            p.isCustom ? 'è‡ªè¨‚' : `$${p.price}`;

        return `
          <div class="product" onclick="selectProduct(${p.id})">
            ${currentStaff && currentStaff.isAdmin && !p.hasOptions && !p.isCustom && !p.hasSubItems ?
            `<button class="product-edit-btn" onclick="event.stopPropagation(); editProduct(${p.id})">âœï¸</button>` : ''}
            <div class="product-emoji">${p.emoji}</div>
            <div class="product-name">${p.name}</div>
            <div class="product-price">${priceDisplay}</div>
          </div>
        `;
      }).join('');
    }

    function editProduct(productId) {
      if (!currentStaff || !currentStaff.isAdmin) {
        alert('âš ï¸ åªæœ‰ç®¡ç†å“¡å¯ä»¥ç·¨è¼¯åƒ¹æ ¼ï¼');
        return;
      }

      const product = products.find(p => p.id === productId);
      if (!product) return;

      editingProductId = productId;
      document.getElementById('edit-product-name').value = product.name;
      document.getElementById('edit-product-price').value = product.price;
      openModal('edit-product-modal');
    }

    function editPriceKeyInput(val) {
      const input = document.getElementById('edit-product-price');
      if (val === 'C') {
        input.value = '';
      } else if (val === 'â†') {
        input.value = input.value.slice(0, -1);
      } else {
        input.value += val;
      }
    }

    function saveProductPrice() {
      const newPrice = parseInt(document.getElementById('edit-product-price').value);
      if (!newPrice || newPrice <= 0) {
        alert('âŒ è«‹è¼¸å…¥æœ‰æ•ˆåƒ¹æ ¼ï¼');
        return;
      }

      const product = products.find(p => p.id === editingProductId);
      if (product) {
        product.price = newPrice;
        saveData();
        renderProducts();
        closeModal('edit-product-modal');
        alert('âœ… åƒ¹æ ¼å·²æ›´æ–°ï¼');
      }
    }

    function selectProduct(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;

      if (product.hasOptions) {
        // ç™¾åˆèŠ±æŸ - é¡¯ç¤ºåƒ¹æ ¼é¸æ“‡è¦–çª—,é»æ“Šç›´æ¥åŠ å…¥
        showQuickPriceSelect(product);
      } else if (product.hasSubItems) {
        // è£é£¾å“ - é¡¯ç¤ºå­é …ç›®é¸æ“‡
        showDecorationSelect(product);
      } else if (product.isCustom) {
        // è‡ªè¨‚å•†å“
        document.getElementById('custom-modal-title').textContent = `${product.emoji} ${product.name}`;
        document.getElementById('price-preset-container').style.display = 'none';
        document.getElementById('custom-name-group').style.display = 'block';
        document.getElementById('custom-product-name').value = '';
        document.getElementById('custom-product-price').value = '';
        window.currentCustomProduct = product;
        openModal('custom-product-modal');
      } else {
        // ä¸€èˆ¬å•†å“ - ç›´æ¥åŠ å…¥è¨‚å–®
        addToOrder(product.id, product.name, product.price);
      }
    }

    function showQuickPriceSelect(product) {
      const modal = document.getElementById('quick-price-modal');
      document.getElementById('quick-price-title').textContent = `${product.emoji} ${product.name}`;

      const container = document.getElementById('quick-price-buttons');
      let buttonsHTML = product.options.map(price => `
        <button class="price-preset-btn" onclick="quickAddToOrder(${product.id}, '${product.name}', ${price}, '${product.emoji}')">
          $${price}
        </button>
      `).join('');

      // åŠ å…¥è‡ªè¨‚åƒ¹æ ¼æŒ‰éˆ•
      buttonsHTML += `
        <button class="price-preset-btn" style="background:var(--primary);color:white" onclick="showCustomPriceInput(${product.id}, '${product.name}', '${product.emoji}')">
          âœï¸ è‡ªè¨‚
        </button>
      `;

      container.innerHTML = buttonsHTML;
      openModal('quick-price-modal');
    }

    function showCustomPriceInput(productId, name, emoji) {
      closeModal('quick-price-modal');
      document.getElementById('custom-modal-title').textContent = `${emoji} ${name} - è‡ªè¨‚åƒ¹æ ¼`;
      document.getElementById('price-preset-container').style.display = 'none';
      document.getElementById('custom-name-group').style.display = 'none';
      document.getElementById('custom-product-price').value = '';
      window.currentCustomProduct = { id: productId, name: name, emoji: emoji, isCustomPrice: true };
      openModal('custom-product-modal');
    }

    function showDecorationSelect(product) {
      const modal = document.getElementById('decoration-modal');
      document.getElementById('decoration-title').textContent = `${product.emoji} ${product.name} - é¸æ“‡æ¬¾å¼`;

      const container = document.getElementById('decoration-buttons');
      container.innerHTML = product.subItems.map((item, index) => `
        <button class="price-preset-btn" onclick="addDecorationToOrder('${item.name}', '${item.emoji}')">
          ${item.emoji} ${item.name}
        </button>
      `).join('');

      openModal('decoration-modal');
    }

    function addDecorationToOrder(itemName, itemEmoji) {
      addToOrder(16, `è£é£¾å“ ${itemName}`, 20, itemEmoji);
      closeModal('decoration-modal');
    }

    function quickAddToOrder(productId, name, price, emoji) {
      addToOrder(productId, `${name} ($${price})`, price, emoji);
      closeModal('quick-price-modal');
    }

    function setPresetPrice(price) {
      document.getElementById('custom-product-price').value = price;
    }

    function modalKeyInput(val) {
      const input = document.getElementById('custom-product-price');
      if (val === 'C') {
        input.value = '';
      } else if (val === 'â†') {
        input.value = input.value.slice(0, -1);
      } else {
        input.value += val;
      }
    }

    function addCustomProduct() {
      const product = window.currentCustomProduct;
      if (!product) return;

      const price = parseInt(document.getElementById('custom-product-price').value);
      if (!price || price <= 0) {
        alert('âŒ è«‹è¼¸å…¥åƒ¹æ ¼ï¼');
        return;
      }

      let name = product.name;

      if (product.isCustomPrice) {
        // ç™¾åˆèŠ±æŸè‡ªè¨‚åƒ¹æ ¼
        name = `${product.name} ($${price})`;
        addToOrder(product.id, name, price, product.emoji);
      } else if (product.hasOptions) {
        // ç™¾åˆèŠ±æŸé è¨­åƒ¹æ ¼
        name = `${product.name} ($${price})`;
        addToOrder(product.id, name, price, product.emoji);
      } else {
        // ä¸€èˆ¬è‡ªè¨‚å•†å“
        const customName = document.getElementById('custom-product-name').value.trim();
        if (customName) name = customName;
        addToOrder(product.id, name, price, product.emoji);
      }

      closeModal('custom-product-modal');
    }

    function filterCategory(cat) {
      currentCategory = cat;
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      renderProducts();
    }

    function searchProducts(query) {
      // ç°¡åŒ–æœå°‹åŠŸèƒ½
      const filtered = products.filter(p => p.name.includes(query));
      const container = document.getElementById('products');
      container.innerHTML = filtered.map(p => {
        let priceDisplay = p.hasOptions ? `$${p.options[0]}-${p.options[p.options.length - 1]}` :
          p.isCustom ? 'è‡ªè¨‚' : `$${p.price}`;
        return `
          <div class="product" onclick="selectProduct(${p.id})">
            <div class="product-emoji">${p.emoji}</div>
            <div class="product-name">${p.name}</div>
            <div class="product-price">${priceDisplay}</div>
          </div>
        `;
      }).join('');
    }

    // ===== è¨‚å–®ç®¡ç† =====
    function addToOrder(productId, name, price, emoji) {
      const existing = currentOrder.find(item =>
        item.productId === productId && item.name === name && item.price === price
      );

      if (existing) {
        existing.quantity++;
      } else {
        const product = products.find(p => p.id === productId);
        currentOrder.push({
          productId: productId,
          name: name,
          price: price,
          emoji: emoji || (product ? product.emoji : 'ğŸŒ¸'),
          quantity: 1
        });
      }

      updateDisplay();
    }

    function updateDisplay() {
      const orderList = document.getElementById('order-list');

      if (currentOrder.length === 0) {
        orderList.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-emoji">ğŸŒº</div>
            <div class="empty-state-text">é»æ“Šå•†å“åŠ å…¥è¨‚å–®</div>
          </div>
        `;
      } else {
        orderList.innerHTML = currentOrder.map((item, index) => `
          <div class="order-item">
            <div class="order-item-emoji">${item.emoji}</div>
            <div class="order-item-info">
              <div class="order-item-name">${item.name}</div>
              <div style="color:var(--text-light);font-size:0.9rem">$${item.price} Ã— ${item.quantity} = $${item.price * item.quantity}</div>
            </div>
            <div class="qty-controls">
              <button class="qty-btn" onclick="changeQty(${index}, -1)">âˆ’</button>
              <div style="font-weight:700;min-width:30px;text-align:center">${item.quantity}</div>
              <button class="qty-btn" onclick="changeQty(${index}, 1)">+</button>
            </div>
            <button class="item-remove" onclick="removeItem(${index})">åˆª</button>
          </div>
        `).join('');
      }

      updateTotals();
    }

    function changeQty(index, delta) {
      currentOrder[index].quantity += delta;
      if (currentOrder[index].quantity <= 0) {
        currentOrder.splice(index, 1);
      }
      updateDisplay();
    }

    function removeItem(index) {
      currentOrder.splice(index, 1);
      updateDisplay();
    }

    function updateTotals() {
      const subtotal = currentOrder.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      const total = subtotal - discountAmount;
      const totalItems = currentOrder.reduce((sum, item) => sum + item.quantity, 0);

      document.getElementById('total-items').textContent = totalItems;
      document.getElementById('total').textContent = `$${total}`;
      document.getElementById('pay').disabled = currentOrder.length === 0;

      updateChange();
    }

    function updateChange() {
      const subtotal = currentOrder.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      const total = subtotal - discountAmount;
      const payment = parseFloat(paymentInput) || 0;
      const change = payment - total;

      const changeEl = document.getElementById('change');
      if (change >= 0) {
        changeEl.textContent = `æ‰¾é›¶ $${change}`;
        changeEl.style.background = 'var(--secondary)';
      } else {
        changeEl.textContent = `é‚„å·® $${Math.abs(change)}`;
        changeEl.style.background = '#ffcccc';
      }
    }

    function newOrder() {
      currentOrder = [];
      paymentInput = '';
      discountAmount = 0;
      document.getElementById('payment-display').textContent = '$0';
      document.getElementById('discount-amount').value = '0';
      updateDisplay();
    }

    function holdOrder() {
      if (currentOrder.length === 0) {
        alert('âš ï¸ è¨‚å–®æ˜¯ç©ºçš„ï¼');
        return;
      }
      heldOrders.push({
        items: [...currentOrder],
        staff: currentStaff ? currentStaff.name : 'æœªçŸ¥',
        timestamp: new Date()
      });
      updateSummary();
      alert(`âœ… å·²æš«å­˜è¨‚å–®ï¼(å…± ${heldOrders.length} ç­†)`);
      newOrder();
    }

    function showHeldOrders() {
      if (heldOrders.length === 0) {
        alert('ğŸ“­ ç›®å‰æ²’æœ‰æš«å­˜è¨‚å–®');
        return;
      }

      const modal = document.getElementById('held-orders-modal');
      const list = document.getElementById('held-orders-list');

      list.innerHTML = heldOrders.map((entry, index) => {
        // å…¼å®¹èˆŠè³‡æ–™æ ¼å¼ (è‹¥æ˜¯é™£åˆ—å‰‡è¦–ç‚ºæ²’æœ‰äººå“¡è¨˜éŒ„çš„è¨‚å–®)
        const isLegacy = Array.isArray(entry);
        const orderItems = isLegacy ? entry : entry.items;
        const staffName = isLegacy ? 'æœªçŸ¥' : (entry.staff || 'æœªçŸ¥');
        const timeStr = isLegacy ? '' : (entry.timestamp ? new Date(entry.timestamp).toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' }) : '');

        const total = orderItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        return `
          <div class="history-order-card" onclick="restoreHeldOrder(${index})">
            <div class="history-order-header">
              <div class="history-order-time">ğŸ“‹ æš«å­˜è¨‚å–® #${index + 1} ${timeStr ? `<span style="font-size:0.8em;color:#666">(${timeStr})</span>` : ''}</div>
              <div class="history-order-total">$${total}</div>
            </div>
            <div class="history-order-items">
              ${orderItems.map(item => `${item.emoji} ${item.name} Ã—${item.quantity}`).join(', ')}
            </div>
            <div style="font-size:0.85rem;color:var(--text-light);margin-top:5px;padding-top:5px;border-top:1px dashed var(--border)">
              ğŸ‘¤ ç¶“æ‰‹: ${staffName}
            </div>
            <div style="margin-top:10px;display:flex;gap:10px">
              <button onclick="event.stopPropagation(); restoreHeldOrder(${index})" 
                style="flex:1;padding:8px;background:var(--success);color:white;border:none;border-radius:8px;font-weight:600;cursor:pointer">
                âœ… æ¢å¾©
              </button>
              <button onclick="event.stopPropagation(); deleteHeldOrder(${index})" 
                style="flex:1;padding:8px;background:var(--danger);color:white;border:none;border-radius:8px;font-weight:600;cursor:pointer">
                ğŸ—‘ï¸ åˆªé™¤
              </button>
            </div>
          </div>
        `;
      }).join('');

      openModal('held-orders-modal');
    }

    function restoreHeldOrder(index) {
      if (currentOrder.length > 0) {
        if (!confirm('âš ï¸ ç•¶å‰è¨‚å–®å°‡è¢«è¦†è“‹ï¼Œæ˜¯å¦ç¹¼çºŒï¼Ÿ')) {
          return;
        }
      }

      const entry = heldOrders[index];
      // å…¼å®¹èˆŠè³‡æ–™
      currentOrder = Array.isArray(entry) ? [...entry] : [...entry.items];

      heldOrders.splice(index, 1);
      updateSummary();
      updateDisplay();
      closeModal('held-orders-modal');
      alert('âœ… å·²æ¢å¾©æš«å­˜è¨‚å–®ï¼');
    }

    function deleteHeldOrder(index) {
      if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹æš«å­˜è¨‚å–®å—ï¼Ÿ')) {
        heldOrders.splice(index, 1);
        updateSummary();
        showHeldOrders();
      }
    }

    function checkout() {
      if (currentOrder.length === 0) return;
      if (!currentStaff) {
        alert('âš ï¸ è«‹å…ˆé¸æ“‡äººå“¡ï¼');
        openModal('staff-modal');
        return;
      }

      const subtotal = currentOrder.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      const total = subtotal - discountAmount;
      const payment = parseFloat(paymentInput) || 0;

      if (payment < total) {
        alert('ğŸ’° å¯¦æ”¶é‡‘é¡ä¸è¶³ï¼');
        return;
      }

      const change = payment - total;
      const now = new Date();
      const dateKey = now.toISOString().split('T')[0];

      if (!orderHistory[dateKey]) {
        orderHistory[dateKey] = [];
      }

      orderHistory[dateKey].push({
        time: now.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' }),
        staff: currentStaff.name,
        items: [...currentOrder],
        subtotal: subtotal,
        discount: discountAmount,
        total: total,
        payment: payment,
        change: change
      });

      dailyRevenue += total;
      saveData();
      updateSummary();

      alert(`âœ… äº¤æ˜“å®Œæˆï¼\n\næ‡‰æ”¶ï¼š$${total}\nå¯¦æ”¶ï¼š$${payment}\næ‰¾é›¶ï¼š$${change}`);
      newOrder();
    }

    function updateSummary() {
      document.getElementById('daily-revenue').textContent = dailyRevenue;
      document.getElementById('holds-count').textContent = heldOrders.length;

      // æ›´æ–°æŒ‰éˆ•ä¸Šçš„æ•¸é‡å¾½ç« 
      const holdBtnCount = document.getElementById('hold-btn-count');
      if (heldOrders.length > 0) {
        holdBtnCount.textContent = heldOrders.length;
        holdBtnCount.style.display = 'inline-block';
      } else {
        holdBtnCount.style.display = 'none';
      }
    }

    function endDay() {
      if (currentOrder.length > 0) {
        alert('âš ï¸ è«‹å…ˆå®Œæˆæˆ–æš«å­˜ç•¶å‰è¨‚å–®ï¼');
        return;
      }

      const today = new Date().toISOString().split('T')[0];
      const todayOrders = orderHistory[today] || [];

      const message = `ğŸŒ™ çµæŸä»Šæ—¥ç‡Ÿæ¥­\n\nä»Šæ—¥ç‡Ÿæ”¶ï¼š$${dailyRevenue}\nä»Šæ—¥è¨‚å–®ï¼š${todayOrders.length} ç­†\n\nç¢ºå®šè¦çµæŸç‡Ÿæ¥­å—ï¼Ÿ`;

      if (confirm(message)) {
        dailyRevenue = 0;
        saveData();
        updateSummary();
        alert('âœ… å·²çµæŸç‡Ÿæ¥­ï¼Œæ˜å¤©è¦‹ï¼');
      }
    }

    // ===== éµç›¤è¼¸å…¥ =====
    function handleKey(val) {
      if (val === 'C') {
        paymentInput = '';
      } else if (val === 'â†') {
        paymentInput = paymentInput.slice(0, -1);
      } else {
        paymentInput += val;
      }
      document.getElementById('payment-display').textContent = `$${paymentInput || '0'}`;
      updateChange();
    }

    function showDiscountKeyboard() {
      document.getElementById('discount-keyboard').style.display = 'grid';
    }

    function hideDiscountKeyboard() {
      document.getElementById('discount-keyboard').style.display = 'none';
    }

    function discountKeyInput(val) {
      const input = document.getElementById('discount-amount');
      if (val === 'C') {
        input.value = '0';
      } else if (val === 'â†') {
        input.value = input.value.slice(0, -1) || '0';
      } else {
        if (input.value === '0') input.value = '';
        input.value += val;
      }
    }

    function applyDiscount() {
      discountAmount = parseInt(document.getElementById('discount-amount').value) || 0;
      updateTotals();
      hideDiscountKeyboard();
    }

    // ===== æ­·å²è¨˜éŒ„ =====
    function updateCalendar() {
      const year = currentMonth.getFullYear();
      const month = currentMonth.getMonth();

      document.getElementById('calendar-month').textContent =
        `${year}å¹´ ${month + 1}æœˆ`;

      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      const view = document.getElementById('calendar-view');
      view.innerHTML = '';

function openHistory() {
  if (!currentStaff) {
    alert('âŒ è«‹å…ˆç™»å…¥äººå“¡');
    return;
  }

  if (!currentStaff.isAdmin) {
    alert('âŒ åƒ…é™ç®¡ç†å“¡æŸ¥çœ‹æ­·å²è¨‚å–®');
    return;
  }

  openModal('history-modal');
}

      // æ˜ŸæœŸæ¨™é¡Œ
      ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'].forEach(day => {
        const header = document.createElement('div');
        header.style.cssText = 'text-align:center;font-weight:700;padding:10px;color:var(--primary)';
        header.textContent = day;
        view.appendChild(header);
      });

      // ç©ºç™½æ—¥æœŸ
      for (let i = 0; i < firstDay; i++) {
        view.appendChild(document.createElement('div'));
      }

      // æ—¥æœŸ
      for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const dayData = orderHistory[dateStr];
        const hasData = dayData && dayData.length > 0;

        const dayEl = document.createElement('div');
        dayEl.className = 'calendar-day' + (hasData ? ' has-data' : '');
        dayEl.onclick = () => hasData && showDayDetail(dateStr);

        let content = `<div class="calendar-date">${day}</div>`;
        if (hasData) {
          // åªå°ç®¡ç†å“¡é¡¯ç¤ºç‡Ÿæ¥­é¡
          if (currentStaff && currentStaff.isAdmin) {
            const revenue = dayData.reduce((sum, order) => sum + order.total, 0);
            content += `<div class="calendar-revenue">$${revenue}</div>`;
          }
        }
        dayEl.innerHTML = content;
        view.appendChild(dayEl);
      }
    }

    function changeMonth(delta) {
      currentMonth.setMonth(currentMonth.getMonth() + delta);
      updateCalendar();
    }

    function showDayDetail(dateStr) {
      const orders = orderHistory[dateStr];
      if (!orders || orders.length === 0) return;

      document.getElementById('day-detail-title').textContent = `ğŸ“‹ ${dateStr} è¨‚å–®æ˜ç´°`;

      const list = document.getElementById('day-detail-list');
      list.innerHTML = orders.map((order, index) => `
        <div class="history-order-card" onclick="showOrderDetail('${dateStr}', ${index})">
          <div class="history-order-header">
            <div class="history-order-time">â° ${order.time}</div>
            <div class="history-order-total">$${order.total}</div>
          </div>
          <div class="history-order-items">
            ${order.items.map(item => `${item.emoji} ${item.name} Ã—${item.quantity}`).join(', ')}
          </div>
          <div class="history-order-detail">
            ğŸ‘¤ ${order.staff} | å¯¦æ”¶: $${order.payment} | æ‰¾é›¶: $${order.change}
          </div>
        </div>
      `).join('');

      closeModal('history-modal');
      openModal('day-detail-modal');
    }

    function showOrderDetail(dateStr, orderIndex) {
      const order = orderHistory[dateStr][orderIndex];
      if (!order) return;

      const content = document.getElementById('order-detail-content');

      // æª¢æŸ¥æ˜¯å¦ç‚ºç®¡ç†å“¡
      const isAdmin = currentStaff && currentStaff.isAdmin;

      if (isAdmin) {
        // ç®¡ç†å“¡å¯ä»¥çœ‹åˆ°å®Œæ•´æ˜ç´°
        content.innerHTML = `
          <div class="order-detail-section">
            <div class="order-detail-header">ğŸ“¦ å•†å“æ˜ç´°</div>
            ${order.items.map(item => `
              <div class="order-detail-item">
                <div>
                  <div class="order-detail-name">${item.emoji} ${item.name}</div>
                  <div class="order-detail-price">å–®åƒ¹: $${item.price} Ã— ${item.quantity}</div>
                </div>
                <div class="order-detail-subtotal">$${item.price * item.quantity}</div>
              </div>
            `).join('')}
          </div>

          <div class="order-detail-section">
            <div class="order-detail-header">ğŸ’° é‡‘é¡æ˜ç´°</div>
            <div class="order-summary-row">
              <span>å°è¨ˆ</span>
              <span>$${order.subtotal}</span>
            </div>
            ${order.discount > 0 ? `
              <div class="order-summary-row" style="color:var(--danger)">
                <span>æŠ˜æ‰£</span>
                <span>- $${order.discount}</span>
              </div>
            ` : ''}
            <div class="order-summary-row total">
              <span>æ‡‰æ”¶</span>
              <span>$${order.total}</span>
            </div>
            <div class="order-summary-row">
              <span>å¯¦æ”¶</span>
              <span>$${order.payment}</span>
            </div>
            <div class="order-summary-row" style="color:var(--success)">
              <span>æ‰¾é›¶</span>
              <span>$${order.change}</span>
            </div>
          </div>

          <div class="order-detail-section">
            <div class="order-detail-header">â„¹ï¸ å…¶ä»–è³‡è¨Š</div>
            <div class="order-summary-row">
              <span>æ—¥æœŸæ™‚é–“</span>
              <span>${dateStr} ${order.time}</span>
            </div>
            <div class="order-summary-row">
              <span>ç¶“æ‰‹äººå“¡</span>
              <span>${order.staff}</span>
            </div>
          </div>
        `;
      } else {
        // éç®¡ç†å“¡åªèƒ½çœ‹åˆ°åŸºæœ¬è³‡è¨Š
        content.innerHTML = `
          <div class="order-detail-section">
            <div class="order-detail-header">ğŸ“¦ å•†å“æ¸…å–®</div>
            ${order.items.map(item => `
              <div class="order-detail-item">
                <div>
                  <div class="order-detail-name">${item.emoji} ${item.name}</div>
                  <div class="order-detail-price">æ•¸é‡: ${item.quantity}</div>
                </div>
              </div>
            `).join('')}
          </div>

          <div class="order-detail-section">
            <div class="order-detail-header">ğŸ’° äº¤æ˜“è³‡è¨Š</div>
            <div class="order-summary-row total">
              <span>æ‡‰æ”¶é‡‘é¡</span>
              <span>$${order.total}</span>
            </div>
            <div class="order-summary-row">
              <span>å¯¦æ”¶é‡‘é¡</span>
              <span>$${order.payment}</span>
            </div>
            <div class="order-summary-row" style="color:var(--success)">
              <span>æ‰¾é›¶</span>
              <span>$${order.change}</span>
            </div>
          </div>

          <div class="order-detail-section">
            <div class="order-detail-header">â„¹ï¸ å…¶ä»–è³‡è¨Š</div>
            <div class="order-summary-row">
              <span>æ—¥æœŸæ™‚é–“</span>
              <span>${dateStr} ${order.time}</span>
            </div>
            <div class="order-summary-row">
              <span>ç¶“æ‰‹äººå“¡</span>
              <span>${order.staff}</span>
            </div>
          </div>
          
          <div style="text-align:center;color:var(--text-light);font-size:0.9rem;margin-top:20px;padding:15px;background:var(--bg);border-radius:10px">
            ğŸ”’ è©³ç´°åƒ¹æ ¼åƒ…ç®¡ç†å“¡å¯è¦‹
          </div>
        `;
      }

      closeModal('day-detail-modal');
      openModal('order-detail-modal');
    }

    // ===== Modal ç®¡ç† =====
    function openModal(id) {
      document.getElementById(id).classList.add('show');
    }

    function closeModal(id) {
      document.getElementById(id).classList.remove('show');
    }

    // é»æ“Šå¤–éƒ¨é—œé–‰
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          overlay.classList.remove('show');
        }
      });
    });

    // ===== å•Ÿå‹• =====
    init();
  </script>
</body>


</html>
